<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="description"
		content="Executable finite state machines for JavaScript and TypeScript supporting the majority of the UML specification for state machines." />
	<meta name="robots" content="index, follow" />
	<title>Executable finite state machines</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://steelbreeze.net/style/steelbreeze.css">
	<link rel="stylesheet" href="./style/state.css">
	<link rel="stylesheet" href="./style/controls.css">
	<style type="text/css">

	</style>

</head>

<body>
	<header>
		<div class="fixedWidth">
			<nav>
				<a href="/">
					<h1>steelbreeze</h1>
				</a>
			</nav>
			<nav>
				<a href="../pivot">pivot</a>
				<a href="../landscape">landscape</a>
				<a href="../state" class="selected">state</a>
			</nav>
		</div>
	</header>
	<main>
		<div class="mainSection">
			<div class="fixedWidth">
				<article>
					<h1>Example state machine</h1>
					<p>The example below shows a working state machine, modelling a cassette player, with the current
						state highlighted
						(as this is a hierarchical machine, you will see the nesting of current state).</p>
				</article>
				<article class="widget">
					<h1>Model</h1>
					<p>The model is implemented in JavaScript as a script in the page, see the page source for details.
					</p>
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
						xmlns:ev="http://www.w3.org/2001/xml-events"
						xmlns:v="http://schemas.microsoft.com/visio/2003/SVGExtensions/" width="8.47846in"
						height="4.35849in" viewBox="0 0 610.449 313.811" xml:space="preserve"
						color-interpolation-filters="sRGB" class="st8">
						<v:documentProperties v:langID="2057" v:metric="true" v:viewMarkup="false" />

						<defs id="Markers">
							<g id="lend3">
								<path d="M 2 1 L 0 0 L 2 -1 "
									style="stroke-linecap:round;stroke-linejoin:round;fill:none" />
							</g>
							<marker id="mrkr3-23" class="st6" v:arrowType="3" v:arrowSize="3" orient="auto"
								markerUnits="strokeWidth" overflow="visible">
								<use xlink:href="#lend3" transform="scale(-2.25,-2.25) " />
							</marker>
						</defs>
						<g v:mID="0" v:index="1" v:groupContext="foregroundPage">
							<title>Page-1</title>
							<v:pageProperties v:drawingScale="0.0393701" v:pageScale="0.0393701" v:drawingUnits="24"
								v:shadowOffsetX="8.50394" v:shadowOffsetY="-8.50394" />
							<v:layer v:name="Connector" v:index="0" />
							<g id="shape13-1" v:mID="13" v:groupContext="shape" transform="translate(42.5197,-71.8661)">
								<title>operational: State</title>
								<desc>operational</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="283.465" cy="87.0394" width="566.93" height="28.3465" />
								<rect x="0" y="72.8661" width="566.929" height="240.945" rx="8.50394" ry="8.50394"
									class="st1" id="operational" />
								<text x="270.18" y="90.34" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />operational</text>
							</g>
							<g id="shape7-4" v:mID="7" v:groupContext="shape" transform="translate(255.118,-86.0394)">
								<title>active: State</title>
								<desc>active</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="170.079" cy="143.732" width="340.16" height="28.3465" />
								<rect x="0" y="129.559" width="340.157" height="184.252" rx="8.50394" ry="8.50394"
									class="st1" id="active" />
								<text x="152.75" y="147.03" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />active</text>
							</g>
							<g id="shape1-7" v:mID="1" v:groupContext="shape" transform="translate(269.291,-100.213)">
								<title>running: State</title>
								<desc>running</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="56.6929" cy="242.945" width="113.39" height="28.3465" />
								<rect x="0" y="228.772" width="113.386" height="85.0394" rx="8.50394" ry="8.50394"
									class="st1" id="running" />
								<text x="39.37" y="246.25" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />running</text>
							</g>
							<g id="shape2-10" v:mID="2" v:groupContext="shape" transform="translate(269.291,-156.906)">
								<title>behaviour</title>
								<desc>entry / startMotor exit / stopMotor</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="63.7795" cy="342.157" width="99.22" height="56.6929" />
								<path d="M0 313.81 L113.39 313.81" class="st3" />
								<text x="14.17" y="338.86" class="st2" v:langID="2057">
									<v:paragraph />
									<v:tabList />entry / startMotor
									<v:newlineChar />
									<tspan x="14.17" dy="1.2em" class="st4">exit </tspan>/ stopMotor
								</text>
							</g>
							<g id="shape3-15" v:mID="3" v:groupContext="shape" transform="translate(467.717,-100.213)">
								<title>paused: State</title>
								<desc>paused</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="56.6929" cy="242.945" width="113.39" height="28.3465" />
								<rect x="0" y="228.772" width="113.386" height="85.0394" rx="8.50394" ry="8.50394"
									class="st1" id="paused" />
								<text x="40.5" y="246.25" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />paused</text>
							</g>
							<g id="shape4-18" v:mID="4" v:groupContext="shape" v:layerMember="0"
								transform="translate(382.677,-163.992)">
								<title>Dynamic connector</title>
								<desc>Pause</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="42.5197" cy="299.638" width="85.04" height="14.1732" />
								<path d="M0 306.72 L85.04 306.72" class="st5" />
								<text x="29.36" y="302.94" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Pause</text>
							</g>
							<g id="shape5-25" v:mID="5" v:groupContext="shape" v:layerMember="0"
								transform="translate(467.717,-135.646)">
								<title>Dynamic connector.5</title>
								<desc>Pause</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="-42.5197" cy="301.055" width="85.04" height="17.0079" />
								<path d="M0 306.72 L-85.04 306.72" class="st5" />
								<text x="-55.68" y="304.36" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Pause</text>
							</g>
							<g id="shape6-31" v:mID="6" v:groupContext="shape" v:layerMember="0"
								transform="translate(467.717,-107.299)">
								<title>Dynamic connector.6</title>
								<desc>Play</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="-42.5197" cy="301.055" width="85.04" height="17.0079" />
								<path d="M0 306.72 L-85.04 306.72" class="st5" />
								<text x="-50.65" y="304.36" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Play</text>
							</g>
							<g id="shape8-37" v:mID="8" v:groupContext="shape" transform="translate(255.118,-241.945)">
								<title>behaviour</title>
								<desc>entry / startMotor exit / stopMotor</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="170.079" cy="342.157" width="311.82" height="56.6929" />
								<path d="M0 313.81 L340.16 313.81" class="st3" />
								<text x="14.17" y="338.86" class="st2" v:langID="2057">
									<v:paragraph />
									<v:tabList />entry / engageHead
									<v:newlineChar />
									<tspan x="14.17" dy="1.2em" class="st4">exit </tspan>/ disengageHead
								</text>
							</g>
							<g id="shape9-42" v:mID="9" v:groupContext="shape" transform="translate(56.6929,-100.213)">
								<title>stopped: State</title>
								<desc>stopped</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="56.6929" cy="242.945" width="113.39" height="28.3465" />
								<rect x="0" y="228.772" width="113.386" height="85.0394" rx="8.50394" ry="8.50394"
									class="st1" id="stopped" />
								<text x="38.39" y="246.25" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />stopped</text>
								<text x="30.39" y="275" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Pause / defer</text>
							</g>
							<g id="shape10-45" v:mID="10" v:groupContext="shape" v:layerMember="0"
								transform="translate(170.079,-149.819)">
								<title>Dynamic connector.10</title>
								<desc>Play</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="49.6063" cy="299.638" width="85.04" height="14.1732" />
								<path d="M0 306.72 L99.21 306.72" class="st5" />
								<text x="36.47" y="302.94" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Play</text>
							</g>
							<g id="shape11-51" v:mID="11" v:groupContext="shape" v:layerMember="0"
								transform="translate(255.118,-121.472)">
								<title>Dynamic connector.11</title>
								<desc>Stop</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="-42.5197" cy="301.055" width="85.04" height="17.0079" />
								<path d="M0 306.72 L-85.04 306.72" class="st5" />
								<text x="-50.16" y="304.36" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Stop</text>
							</g>
							<g id="shape12-57" v:mID="12" v:groupContext="shape"
								transform="translate(99.2126,-241.945)">
								<title>history: PseudoState</title>
								<desc>H*</desc>
								<v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197" />
								<v:textRect cx="14.1732" cy="299.638" width="28.35" height="28.3465" />
								<ellipse cx="14.1732" cy="299.638" rx="14.1732" ry="14.1732" class="st1" />
								<text x="8.01" y="302.94" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />H*</text>
							</g>
							<g id="shape14-60" v:mID="14" v:groupContext="shape"
								transform="translate(42.5197,-284.465)">
								<title>Sheet.14</title>
								<path d="M0 313.81 L566.93 313.81" class="st3" />
							</g>
							<g id="shape14-61" v:mID="14" v:groupContext="shape"
								transform="translate(42.5197,-284.465)">
								<title>Sheet.15</title>
								<path d="M14 441.5 L128 441.5" class="st3" />
							</g>
							<g id="shape15-63" v:mID="15" v:groupContext="shape" transform="translate(255.118,-1)">
								<title>flipped: State</title>
								<desc>flipped</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="170.079" cy="292.551" width="340.16" height="42.5197" />
								<rect x="0" y="271.291" width="340.157" height="42.5197" rx="8.50394" ry="8.50394"
									class="st1" id="flipped" />
								<text x="154.47" y="295.85" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />flipped</text>
							</g>
							<g id="shape16-66" v:mID="16" v:groupContext="shape" v:layerMember="0"
								transform="translate(516.614,-43.5197)">
								<title>Dynamic connector.16</title>
								<desc>Flip</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="43.2283" cy="299.638" width="70.87" height="17.0079" />
								<path d="M7.09 313.81 L7.09 285.46" class="st5" />
								<text x="12.28" y="302.94" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Flip</text>
							</g>
							<g id="shape17-72" v:mID="17" v:groupContext="shape" v:layerMember="0"
								transform="translate(318.898,-71.8661)">
								<title>Dynamic connector.17</title>
								<desc>Flip</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="42.5197" cy="327.984" width="70.87" height="17.0079" />
								<path d="M7.09 313.81 L7.09 342.16" class="st5" />
								<text x="11.57" y="331.28" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Flip</text>
							</g>
							<g id="shape18-78" v:mID="18" v:groupContext="shape" v:layerMember="0"
								transform="translate(106.299,-241.945)">
								<title>Dynamic connector.18</title>
								<path d="M7.09 313.81 L7.09 370.5" class="st5" />
							</g>
							<g id="shape20-83" v:mID="20" v:groupContext="shape"
								transform="translate(56.6929,-15.1732)">
								<title>Sheet.20</title>
								<desc>initial</desc>
								<v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197" />
								<v:textRect cx="14.1732" cy="320.898" width="56.7" height="14.1732" />
								<ellipse cx="14.1732" cy="299.638" rx="14.1732" ry="14.1732" class="st7" />
								<text x="1.76" y="324.2" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />initial</text>
							</g>
							<g id="shape21-86" v:mID="21" v:groupContext="shape" v:layerMember="0"
								transform="translate(63.7795,-43.5197)">
								<title>Dynamic connector.21</title>
								<path d="M7.09 313.81 L7.09 285.46" class="st5" />
							</g>
							<g id="shape23-91" v:mID="23" v:groupContext="shape" v:layerMember="0"
								transform="translate(148.819,-71.8661)">
								<title>Dynamic connector.23</title>
								<desc>Stop</desc>
								<v:textBlock v:margins="rect(0,0,0,0)" v:tabSpace="42.5197" />
								<v:textRect cx="49.6063" cy="327.984" width="85.04" height="17.0079" />
								<path d="M7.09 313.81 L7.09 342.16" class="st5" />
								<text x="14.72" y="331.28" class="st2" v:langID="2057">
									<v:paragraph v:horizAlign="1" />
									<v:tabList />Stop</text>
							</g>
							<g id="group24-97" transform="translate(141.732,-15.1732)" v:mID="24"
								v:groupContext="group">
								<title>Sheet.24</title>
								<g id="shape19-98" v:mID="19" v:groupContext="shape">
									<title>Sheet.19</title>
									<desc>final</desc>
									<v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197" />
									<v:textRect cx="14.1732" cy="320.898" width="56.7" height="14.1732" />
									<ellipse cx="14.1732" cy="299.638" rx="14.1732" ry="14.1732" class="st1"
										id="finalState" />
									<text x="4.45" y="324.2" class="st2" v:langID="2057">
										<v:paragraph v:horizAlign="1" />
										<v:tabList />final</text>
								</g>
								<g id="shape22-101" v:mID="22" v:groupContext="shape"
									transform="translate(6.37795,-6.37795)">
									<title>Sheet.22</title>
									<ellipse cx="7.79528" cy="306.016" rx="7.79528" ry="7.79528" class="st7" />
								</g>
							</g>
						</g>
					</svg>
				</article>
				<article class="widget">
					<h1>Events</h1>
					<p>Use the buttons below to send triggering events into the machine for evaluation.</p>
					<button class="ripple" onclick="instance.evaluate(new Play());">play</button>
					<button class="ripple" onclick="instance.evaluate(new Pause());">pause</button>
					<button class="ripple" onclick="instance.evaluate(new Stop());">stop</button>
					<button class="ripple" onclick="instance.evaluate(new Flip());">flip</button>
				</article>
				<article class="widget">
					<h1>Outputs</h1>
					<p>Below are the outputs of the state machine, in this example controlling the cassette players
						head and motor</p>
					<p>Head: <span id="head">disengaged</span></p>
					<p>Motor: <span id="motor">stopped</span></p>
				</article>
				<article>
					<p>Links: <a href="https://github.com/steelbreeze/state">Github</a></p>
				</article>
			</div>
		</div>
		<div class="mainSection">
			<div class="fixedWidth">

				<article>
					<h1>Notes</h1>
					<p>In addition to basic state transitions, this example shows a few more advanced features:
						first, deep history is
						specified in
						the operational state, meaning when returning from the flipped state, the machine will
						revert to the state it was
						in
						prior to entering the flipped state; next, there are two transitions that respond to the
						Stop event, this
						shows depth-first evaluation; last, the transition from stopped to running crosses the
						region boundary within the
						active state such that there is no need for an initial state; last, the stopped state can
						defer the Pause event
						for evaluation after it has been exited.</p>
					<p>The active state configuration changes colour on state entry/exit with transparency to show
						the nesting of the
						current state. If you open your browser console you will see some further log output.</p>
				</article>
			</div>
		</div>
	</main>
	<html-include href="https://steelbreeze.net/components/footer.html"></html-include>
	<script src = "https://steelbreeze.net/components/html-include.js"></script>
	<script src="lib/state.js"></script>
	<script>
		let head = document.getElementById("head");
		let motor = document.getElementById("motor");

		// create our event types (should simply use class but this is IE friendly)
		var Play = (function () { function Play() { } return Play; }());
		var Pause = (function () { function Pause() { } return Pause; }());
		var Stop = (function () { function Stop() { } return Stop; }());
		var Flip = (function () { function Flip() { } return Flip; }());

		// define the operations that the state machine will call as outputs
		function startMotor() { motor.innerText = "running"; }
		function stopMotor() { motor.innerText = "stopped"; }
		function engageHead() { head.innerText = "engaged"; }
		function disengageHead() { head.innerText = "disengaged"; }

		// log to the browser console
		state.log.add(function (message) { console.info(message); }, state.log.Entry | state.log.Exit);

		// create the state machine model elements/
		var model = new state.State("model");
		var initial = new state.PseudoState("initial", model, state.PseudoStateKind.Initial);
		var operational = new state.State("operational", model);
		var flipped = new state.State("flipped", model);
		var finalState = new state.State("finalState", model);
		var deepHistory = new state.PseudoState("history", operational, state.PseudoStateKind.DeepHistory);
		var stopped = new state.State("stopped", operational);
		var active = new state.State("active", operational);
		var running = new state.State("running", active);
		var paused = new state.State("paused", active);

		// defer pause events while in the stopped state
		stopped.defer(Pause);

		/* create the state machine model transitions */
		initial.to(operational);
		deepHistory.to(stopped);
		stopped.on(Play).to(running);
		active.on(Stop).to(stopped);
		running.on(Pause).to(paused);
		paused.on(Play).to(running);
		paused.on(Pause).to(running);
		operational.on(Flip).to(flipped);
		flipped.on(Flip).to(operational);
		operational.on(Stop).to(finalState);

		// define the state entry/exit behaviour
		active.entry(engageHead).exit(disengageHead);
		running.entry(startMotor).exit(stopMotor);

		// colour the states on entry/exit
		//		operational.entry(function () { document.getElementById("operational").setAttribute("class", "st1 active"); }).exit(function () { document.getElementById("operational").setAttribute("class", "st1"); });
		stopped.entry(function () { document.getElementById("stopped").setAttribute("class", "st1 active"); }).exit(function () { document.getElementById("stopped").setAttribute("class", "st1"); });
		//		active.entry(function () { document.getElementById("active").setAttribute("class", "st1 active"); }).exit(function () { document.getElementById("active").setAttribute("class", "st1"); });
		running.entry(function () { document.getElementById("running").setAttribute("class", "st1 active"); }).exit(function () { document.getElementById("running").setAttribute("class", "st1"); });
		paused.entry(function () { document.getElementById("paused").setAttribute("class", "st1 active"); }).exit(function () { document.getElementById("paused").setAttribute("class", "st1"); });
		flipped.entry(function () { document.getElementById("flipped").setAttribute("class", "st1 active"); }).exit(function () { document.getElementById("flipped").setAttribute("class", "st1"); });
		finalState.entry(function () { document.getElementById("finalState").setAttribute("class", "st1 active"); });

		// create an instance of the model
		let instance = new state.Instance("instance", model);
	</script>

</body>

</html>